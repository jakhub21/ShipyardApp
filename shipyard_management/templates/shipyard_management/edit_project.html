{% extends "base.html" %}
{% load static %}

{% block title %}
    Edit Project
{% endblock %}

{% block content %}
    <h1>Edit Project</h1>
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <div id="map" style="height: 400px; margin-top: 20px;"></div>
        <button type="submit" class="btn btn-primary">Save</button>
    </form>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <script>
        const defaultLatitude = {{ form.latitude.value|default:52.2297 }};
        const defaultLongitude = {{ form.longitude.value|default:21.0122 }};

        const map = L.map('map').setView([defaultLatitude, defaultLongitude], 6);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);

        let marker = L.marker([defaultLatitude, defaultLongitude], { draggable: true }).addTo(map);

        marker.on('dragend', function (e) {
            const latLng = marker.getLatLng();
            document.querySelector('[name="latitude"]').value = latLng.lat;
            document.querySelector('[name="longitude"]').value = latLng.lng;
        });

        map.on('click', function (e) {
            const { lat, lng } = e.latlng;
            marker.setLatLng([lat, lng]);
            document.querySelector('[name="latitude"]').value = lat;
            document.querySelector('[name="longitude"]').value = lng;
        });
    </script>
{% endblock %}
