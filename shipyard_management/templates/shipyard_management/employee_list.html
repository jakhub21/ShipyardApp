{% extends "base.html" %}
{% load static %}

{% block title %}
    Employee List
{% endblock %}

{% block content %}
    <h1>Employee List</h1>
    <form method="GET" action="{% url 'employee_list' %}">
        <input type="text" name="q" id="search-input" placeholder="Search by name or surname..." value="{{ query|default_if_none:'' }}">
    </form>
    <a href="{% url 'employee_create' %}" class="btn btn-success">Create new employee</a>
    <ul>
        {% for employee in employees %}
            <li> 
                <a href="{{ employee.get_absolute_url }}">{{ employee.first_name }} {{ employee.last_name }} | {{ employee.status }} | {{ employee.position }} | 
                <a href="{% url 'edit_employee' employee.slug %}" class="btn btn-primary">Edit</a> 
                <form action="{% url 'delete_employee' employee.slug %}" method="POST" style="display:inline;" class="delete-form">
                    {% csrf_token %}
                    <button type="submit">Delete</button>
                </form>
            </li>
        {% empty %}
            <li>No employees found</li>
        {% endfor %}
    </ul>

    <script>
        let timeout = null;
        document.getElementById('search-input').addEventListener('input', function() {
            clearTimeout(timeout);
            timeout = setTimeout(function() {
                document.querySelector('search-form').submit();
            }, 500);
        });

        document.querySelectorAll('.delete-form').forEach(form => {
            form.addEventListener('submit', function (event) {
                const confirmed = confirm('Do you want to delete this worker?');
                if (!confirmed) {
                    event.preventDefault(); 
                }
            });
        });
</script>
{% endblock %}
